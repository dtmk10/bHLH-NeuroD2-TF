"ATGCAATT",
"AAGCAAAG"
)
# Building the PPSM, only works with equal length observations
AssemblingPPSM <- function(obs){
seqMatrix <- matrix(nrow = length(obs), ncol = length(c(strsplit(obs[1],""))[[1]]), byrow = TRUE)
for(i in 1:length(obs)){
seqMatrix[i,] <- c(strsplit(obs[i],""))[[1]]
}
PPSM <<- matrix(0, nrow = 4, ncol = length(c(strsplit(obs[1],""))[[1]]))
rownames(PPSM) <<- c("A","C","G","T")
colnames(PPSM) <<- c(1:length(c(strsplit(obs[1],""))[[1]]))
for (j in 1:length(c(strsplit(obs[1],""))[[1]])) {
columnFreqReport <- rle(sort(seqMatrix[,j]))
for (i in 1:length(columnFreqReport$values)) {
PPSM[match(columnFreqReport$values[i],rownames(PPSM)),j] <<- columnFreqReport$lengths[i]
}
}
}
AssemblingPPSM(observation)
# Making the comparision with the null model
NullModelComparison <- function(PPSM,observation){
# First build the null model
nullModel <<- matrix(length(c(strsplit(observation[1],""))[[1]])/4,nrow = 4, ncol = length(c(strsplit(observation[1],""))[[1]]))
# Now we rebuild the matrixes with the probability to see each nucleotid with that number of counts
# We modify PPSM to include pseudocounts
for(i in 1:4){
for(j in 1:length(c(strsplit(observation[1],""))[[1]])){
PPSM[i,j] <<- (PPSM[i,j]+1/length(c(strsplit(observation[1],""))[[1]]))/(length(c(strsplit(observation[1],""))[[1]])+1)
nullModel[i,j] <<- nullModel[i,j]/length(c(strsplit(observation[1],""))[[1]])
}
}
}
NullModelComparison(PPSM,observation)
# Now we need to make the LogLikelihoodMatrix, this will give us the score that we should apply to each nucleotide in the motif
AssemblingLogLikelihoodRatioMatrix <- function(PPSM,nullModel, observation){
# Building the matrix
LogLikelihoodRatioMatrix <<- matrix(nrow = 4, ncol = length(c(strsplit(observation[1],""))[[1]]))
colnames(LogLikelihoodRatioMatrix) <<- 1:length(observation)
rownames(LogLikelihoodRatioMatrix) <<- c("A","C","G","T")
for (i in 1:4) {
for (j in 1:length(c(strsplit(observation[1],""))[[1]])) {
LogLikelihoodRatioMatrix[i,j] <<- log(PPSM[i,j]/nullModel[i,j])
}
}
}
AssemblingLogLikelihoodRatioMatrix(PPSM, nullModel, observation)
# Once we have this matrix we can calculate the score of each of the entries that we got
EntryScore <- function(observation){
for(i in 1:length(observation)){
seqScore <<- 0
for (j in 1:length(c(strsplit(observation[i],""))[[1]])) {
seqScore <<- LogLikelihoodRatioMatrix[match(c(strsplit(observation[i],"")[[1]][j]),rownames(LogLikelihoodRatioMatrix)),j] + seqScore
}
print(seqScore)
}
}
EntryScore(observation)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- Uncertainty + (PPSM[i,j]*log2(PPSM[i,j]))
}
print(Uncertainty)
Uncertainty <- 0
}
}
InfoContentMatrixAssembly(observation)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- Uncertainty + (PPSM[i,j]*log2(PPSM[i,j]))
print(Uncertainty)
}
ICfinal <- 2 + Uncertainty
Uncertainty <- 0
}
}
InfoContentMatrixAssembly(observation)
log2(0)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- Uncertainty + (PPSM[i,j]*log2(PPSM[i,j]))
}
ICfinal <- 2 + Uncertainty
print(ICfinal)
Uncertainty <- 0
}
}
InfoContentMatrixAssembly(observation)
log2(0.8)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- Uncertainty + (PPSM[i,j]*log2(PPSM[i,j]))
}
ICfinal <- 2 + Uncertainty
print(ICfinal)
}
}
InfoContentMatrixAssembly(observation)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- Uncertainty + (PPSM[i,j]*log2(PPSM[i,j]))
}
ICfinal <- 2 - Uncertainty
print(ICfinal)
}
}
InfoContentMatrixAssembly(observation)
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- - Uncertainty + (PPSM[i,j]*log2(PPSM[i,j]))
}
ICfinal <- 2 - Uncertainty
print(ICfinal)
}
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- - Uncertainty + (PPSM[i,j]*log2(PPSM[i,j]))
}
ICfinal <- 2 - Uncertainty
print(ICfinal)
}
}
InfoContentMatrixAssembly(observation)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- - Uncertainty + (PPSM[i,j]*log2(PPSM[i,j]))
print(Uncertainty)
}
ICfinal <- 2 - Uncertainty
}
}
InfoContentMatrixAssembly(observation)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- - (Uncertainty + (PPSM[i,j]*log2(PPSM[i,j])))
print(Uncertainty)
}
ICfinal <- 2 - Uncertainty
}
}
InfoContentMatrixAssembly(observation)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- - (Uncertainty + (PPSM[i,j]*log2(PPSM[i,j])))
}
ICfinal <- 2 - Uncertainty
print(ICfinal)
}
}
InfoContentMatrixAssembly(observation)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
IC
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- - (Uncertainty + (PPSM[i,j]*log2(PPSM[i,j])))
}
}
ICfinal <- 2 - Uncertainty
print(ICfinal)
}
InfoContentMatrixAssembly(observation)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
InfoContentMatrixAssembly <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- - (Uncertainty + (PPSM[i,j]*log2(PPSM[i,j])))
}
}
ICfinal <- 2 - Uncertainty
print(ICfinal)
}
InfoContentMatrixAssembly(observation)
# Information content Matrix
# La probabilidad de obtener un nucleotido por la probabilidad de obtenerlo log(2) USANDO PPSM
ICfinalcalculus <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- - (Uncertainty + (PPSM[i,j]*log2(PPSM[i,j])))
}
}
ICfinal <<- 2 - Uncertainty
}
ICfinalcalculus(observation)
InformationContentMatrixAssembly <- function(observation){
ICM <<- matrix(nrow = 4, ncol = length(c(strsplit(observation[1],""))[[1]]))
colnames(ICM) <<- 1:length(observation)
rownames(ICM) <<- c("A","C","G","T")
for(i in 1:4){
for (j in 1:length(c(strsplit(observation[i],""))[[1]])) {
ICM[i,j] <<- PPSM[i,j] * ICfinal
}
}
}
InformationContentMatrixAssembly <- function(observation){
ICM <<- matrix(nrow = 4, ncol = length(c(strsplit(observation[1],""))[[1]]))
colnames(ICM) <<- 1:length(observation)
rownames(ICM) <<- c("A","C","G","T")
for(i in 1:4){
for (j in 1:length(c(strsplit(observation[i],""))[[1]])) {
ICM[i,j] <<- PPSM[i,j] * ICfinal
}
}
}
InformationContentMatrixAssembly(observation)
View(ICM)
observation <- c(
"TTGCAAAT",
"ATGCATAT",
"ATTCAAAT",
"ATGCAAAA",
"ATGCAAAT",
"ATGCAATT",
"ATGCAATT",
"AAGCAAAG"
)
# Building the PPSM, only works with equal length observations
AssemblingPPSM <- function(obs){
seqMatrix <- matrix(nrow = length(obs), ncol = length(c(strsplit(obs[1],""))[[1]]), byrow = TRUE)
for(i in 1:length(obs)){
seqMatrix[i,] <- c(strsplit(obs[i],""))[[1]]
}
PPSM <<- matrix(0, nrow = 4, ncol = length(c(strsplit(obs[1],""))[[1]]))
rownames(PPSM) <<- c("A","C","G","T")
colnames(PPSM) <<- c(1:length(c(strsplit(obs[1],""))[[1]]))
for (j in 1:length(c(strsplit(obs[1],""))[[1]])) {
columnFreqReport <- rle(sort(seqMatrix[,j]))
for (i in 1:length(columnFreqReport$values)) {
PPSM[match(columnFreqReport$values[i],rownames(PPSM)),j] <<- columnFreqReport$lengths[i]
}
}
}
AssemblingPPSM(observation)
# Making the comparision with the null model
NullModelComparison <- function(PPSM,observation){
# First build the null model
nullModel <<- matrix(length(c(strsplit(observation[1],""))[[1]])/4,nrow = 4, ncol = length(c(strsplit(observation[1],""))[[1]]))
# Now we rebuild the matrixes with the probability to see each nucleotid with that number of counts
# We modify PPSM to include pseudocounts
for(i in 1:4){
for(j in 1:length(c(strsplit(observation[1],""))[[1]])){
PPSM[i,j] <<- (PPSM[i,j]+1/length(c(strsplit(observation[1],""))[[1]]))/(length(c(strsplit(observation[1],""))[[1]])+1)
nullModel[i,j] <<- nullModel[i,j]/length(c(strsplit(observation[1],""))[[1]])
}
}
}
NullModelComparison(PPSM,observation)
# Now we need to make the LogLikelihoodMatrix, this will give us the score that we should apply to each nucleotide in the motif
AssemblingLogLikelihoodRatioMatrix <- function(PPSM,nullModel, observation){
# Building the matrix
LogLikelihoodRatioMatrix <<- matrix(nrow = 4, ncol = length(c(strsplit(observation[1],""))[[1]]))
colnames(LogLikelihoodRatioMatrix) <<- 1:length(observation)
rownames(LogLikelihoodRatioMatrix) <<- c("A","C","G","T")
for (i in 1:4) {
for (j in 1:length(c(strsplit(observation[1],""))[[1]])) {
LogLikelihoodRatioMatrix[i,j] <<- log(PPSM[i,j]/nullModel[i,j])
}
}
}
AssemblingLogLikelihoodRatioMatrix(PPSM, nullModel, observation)
# Once we have this matrix we can calculate the score of each of the entries that we got
EntryScore <- function(observation){
for(i in 1:length(observation)){
seqScore <<- 0
for (j in 1:length(c(strsplit(observation[i],""))[[1]])) {
seqScore <<- LogLikelihoodRatioMatrix[match(c(strsplit(observation[i],"")[[1]][j]),rownames(LogLikelihoodRatioMatrix)),j] + seqScore
}
print(seqScore)
}
}
EntryScore(observation)
# Information content Matrix
ICfinalcalculus <- function(observation){
Uncertainty <- 0
for(j in 1:length(c(strsplit(observation[i],""))[[1]])){
for (i in 1:4) {
Uncertainty <- - (Uncertainty + (PPSM[i,j]*log2(PPSM[i,j])))
}
}
ICfinal <<- 2 - Uncertainty
}
ICfinalcalculus(observation)
observation <- c(
"TTGCAAAT",
"ATGCATAT",
"ATTCAAAT",
"ATGCAAAA",
"ATGCAAAT",
"ATGCAATT",
"ATGCAATT",
"AAGCAAAG"
)
# Building the PPSM, only works with equal length observations
AssemblingPPSM <- function(obs){
seqMatrix <- matrix(nrow = length(obs), ncol = length(c(strsplit(obs[1],""))[[1]]), byrow = TRUE)
for(i in 1:length(obs)){
seqMatrix[i,] <- c(strsplit(obs[i],""))[[1]]
}
PPSM <<- matrix(0, nrow = 4, ncol = length(c(strsplit(obs[1],""))[[1]]))
rownames(PPSM) <<- c("A","C","G","T")
colnames(PPSM) <<- c(1:length(c(strsplit(obs[1],""))[[1]]))
for (j in 1:length(c(strsplit(obs[1],""))[[1]])) {
columnFreqReport <- rle(sort(seqMatrix[,j]))
for (i in 1:length(columnFreqReport$values)) {
PPSM[match(columnFreqReport$values[i],rownames(PPSM)),j] <<- columnFreqReport$lengths[i]
}
}
}
AssemblingPPSM(observation)
# Making the comparision with the null model
NullModelComparison <- function(PPSM,observation){
# First build the null model
nullModel <<- matrix(length(c(strsplit(observation[1],""))[[1]])/4,nrow = 4, ncol = length(c(strsplit(observation[1],""))[[1]]))
# Now we rebuild the matrixes with the probability to see each nucleotid with that number of counts
# We modify PPSM to include pseudocounts
for(i in 1:4){
for(j in 1:length(c(strsplit(observation[1],""))[[1]])){
PPSM[i,j] <<- (PPSM[i,j]+1/length(c(strsplit(observation[1],""))[[1]]))/(length(c(strsplit(observation[1],""))[[1]])+1)
nullModel[i,j] <<- nullModel[i,j]/length(c(strsplit(observation[1],""))[[1]])
}
}
}
NullModelComparison(PPSM,observation)
# Now we need to make the LogLikelihoodMatrix, this will give us the score that we should apply to each nucleotide in the motif
AssemblingLogLikelihoodRatioMatrix <- function(PPSM,nullModel, observation){
# Building the matrix
LogLikelihoodRatioMatrix <<- matrix(nrow = 4, ncol = length(c(strsplit(observation[1],""))[[1]]))
colnames(LogLikelihoodRatioMatrix) <<- 1:length(observation)
rownames(LogLikelihoodRatioMatrix) <<- c("A","C","G","T")
for (i in 1:4) {
for (j in 1:length(c(strsplit(observation[1],""))[[1]])) {
LogLikelihoodRatioMatrix[i,j] <<- log(PPSM[i,j]/nullModel[i,j])
}
}
}
AssemblingLogLikelihoodRatioMatrix(PPSM, nullModel, observation)
# Once we have this matrix we can calculate the score of each of the entries that we got
EntryScore <- function(observation){
for(i in 1:length(observation)){
seqScore <<- 0
for (j in 1:length(c(strsplit(observation[i],""))[[1]])) {
seqScore <<- LogLikelihoodRatioMatrix[match(c(strsplit(observation[i],"")[[1]][j]),rownames(LogLikelihoodRatioMatrix)),j] + seqScore
}
print(seqScore)
}
}
EntryScore(observation)
# Information content Matrix
ICfinalcalculus <- function(observation){
Uncertainty <- 0
for(i in 1:4){
for (j in 1:length(c(strsplit(observation[i],""))[[1]])) {
Uncertainty <- - (Uncertainty + (PPSM[i,j]*log2(PPSM[i,j])))
}
}
ICfinal <<- 2 - Uncertainty
}
ICfinalcalculus(observation)
InformationContentMatrixAssembly <- function(observation){
ICM <<- matrix(nrow = 4, ncol = length(c(strsplit(observation[1],""))[[1]]))
colnames(ICM) <<- 1:length(observation)
rownames(ICM) <<- c("A","C","G","T")
for(i in 1:4){
for (j in 1:length(c(strsplit(observation[i],""))[[1]])) {
ICM[i,j] <<- PPSM[i,j] * ICfinal
}
}
}
InformationContentMatrixAssembly(observation)
BiocManager::install("ChIPseeker")
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("ChIPseeker")
rownames(package)
library(abind)
detach("package:abind", unload = TRUE)
installed.packages()
paquetes_a_eliminar <- install.packages()[is.na(installed.packages()[, "Priority"]), 1]
paquetes <- installed.packages()
paquetes_a_eliminar <- paquetes[is.na(paquetes[, "Priority"]), 1]
print(paquetes_a_eliminar)
paquetes[,"Priority"]
View(paquetes)
is.na(paquetes[, "Priority"])
is.na(paquetes[, "Priority"]), 1
paquetes[is.na(paquetes[, "Priority"]), 1]
paquetes_a_eliminar <- paquetes[is.na(paquetes[, "Priority"]), 1]
paquetes <- installed.packages()
paquetes_a_eliminar <- paquetes[is.na(paquetes[, "Priority"]), 1]
remove.packages(paquetes_a_eliminar)
installed.packages()
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("ChIPseeker")
update.packages(ask = FALSE, checkBuilt = TRUE)
package_version(BiocManager)
install.packages(c("tidyr","car","ggplot2","gridExtra"))
library(ReactomePA)
library("ChIPseeker")
library("ChIPseeker")
library("ReactomePA")
setwd("/home/diego/Documents/PGB-Workspace/bHLH-project/ChIP_seq/PeakCalling")
narrowPeaks <- readPeakFile("IP_peaks.narrowPeak")
peaksResized <- readPeakFile("IP_peaks.resized.bed")
# Example annotation of Mus musculus
library(TxDb.Mmusculus.UCSC.mm10.knownGene)
txdb <- TxDb.Mmusculus.UCSC.mm10.knownGene
peakAnno <- annotatePeak(narrowPeaks, tssRegion=c(-3000, 3000),
TxDb=txdb)
library(org.Mm.eg.db)
mmdb <- org.Mm.eg.db
pathway1 <- enrichPathway(as.character(as.data.frame(peakAnno)$geneId), organism = "mouse")
browseVignettes("ChIPseeker")
gene <- seq2gene(peaksResized, tssRegion = c(-1000, 1000), flankDistance = 3000, TxDb=txdb)
enrichPathway(gene)
enrichPathway(gene, organism = "mouse")
enrichPathway(as.character(as.data.frame(peakAnno)$geneId), organism = "mouse")
enrichPathway(gene, organism = "mouse")
sum(pathway1@result$pvalue < 0.05)
sum(pathway1@result$p.adjust < 0.05)
pathwayResized <- enrichPathway(gene, organism = "mouse")
dotplot(pathway1)
sum(pathwayResized@result$p.adjust < 0.05)
dotplot(pathwayResized)
upsetplot(peakAnno, vennpie=TRUE)
plotAnnoPie(peakAnno)
peak_Profile_Heatmap(peak = narrowPeaks,
upstream = 1000,
downstream = 1000,
by = "gene",
type = "start_site",
TxDb = txdb,
nbin = 800)
setwd("~/Documents/PGB-Workspace/bHLH-project/ChIP_seq/PeakCalling")
narrowPeaks <- readPeakFile("IP_peaks.narrowPeak")
peaksResized <- readPeakFile("IP_peaks.resized.bed")
tagHeatmap(tagMatrix)
# Peak spread over the genome
covplot(peaksResized, weightCol = "V5")
peaksResized <- readPeakFile("IP_peaks.resized.bed")
library("ChIPseeker")
library("ReactomePA")
# annotation of Mus musculus
library(TxDb.Mmusculus.UCSC.mm10.knownGene)
txdb <- TxDb.Mmusculus.UCSC.mm10.knownGene
setwd("~/Documents/PGB-Workspace/bHLH-project/ChIP_seq/PeakCalling")
narrowPeaks <- readPeakFile("IP_peaks.narrowPeak")
peaksResized <- readPeakFile("IP_peaks.resized.bed")
# Peak spread over the genome
covplot(peaksResized, weightCol = "V5")
# Peak spread over the genome
covplot(narrowPeaks, weightCol = "V5")
tagMatrix <- getTagMatrix(peaksResized, windows=promoter)
promoter <- getPromoters(TxDb=txdb, upstream=3000, downstream=3000)
tagMatrix <- getTagMatrix(peaksResized, windows=promoter)
tagHeatmap(tagMatrix)
peakHeatmap(narrowPeaks, TxDb=txdb, upstream=3000, downstream=3000)
peak_Profile_Heatmap(peak = peaksResized,
upstream = 1000,
downstream = 1000,
by = "gene",
type = "start_site",
TxDb = txdb,
nbin = 800)
peakAnno <- annotatePeak(peaksResized, tssRegion=c(-3000, 3000),
TxDb=txdb)
plotAnnoPie(peakAnno)
vennpie(peakAnno)
plotDistToTSS(peakAnno, title = "Dist to TSS")
library(org.Mm.eg.db)
mmdb <- org.Mm.eg.db
